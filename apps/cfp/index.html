<link rel="icon" type="image/png" href="favicon.ico">

<style type="text/css">
body {
    background-color: #99ccff;
}

#conferences {
  width: 100%;
  text-align: center;
}

#timenow {
  display: inline-block;
}

.conference-box{
    display: inline-block;
    width: 50%;
    background:#cce5ff;
    border: 1px solid #000;
    -moz-border-radius: 15px;
    border-radius: 15px;
    margin-top: 10px;
}

#bannerImage{
    height: 250px;
}

.timeleft{
    color: red;
}

.title{
    font-size:x-large;
}
</style>

<script src="js/jquery-1.3.2.js" type="text/javascript"></script>
<script src="js/moment.min.js" type="text/javascript"></script>
<script type="text/javascript">
    function drawTable(conferences){
        var cfpDiv = '';
        var count = 0;
        for (var c in conferences) {  
            // Skip if already passed
            if (moment(conferences[c].deadlines[conferences[c].deadlines.length - 1].date).diff(moment()) < 0){
                continue;
            }

            cfpDiv += '<div class="conference-box"><span class="title"><a href="' + conferences[c].url + '" target="_blank">';
            cfpDiv += conferences[c].name + '</a></span><br/>';
            //for (var t in conferences[c].deadlines)
            for (var i = 0; i < conferences[c].deadlines.length; i++){
                var cdate = moment(conferences[c].deadlines[i].date);
                cfpDiv += '<div class="deadline-box"><span class="cfpitem">' + conferences[c].deadlines[i].name;
                cfpDiv += '&nbsp;(' + cdate.format("YYYY-MM-DD") + ')</span>';
                cfpDiv += '&nbsp;<span class="timeleft">' + moment().to(cdate) + '</span></div>';
            }
            cfpDiv += '</div>'
            count += 1;
        }

        if (count < 5)
        {
            cfpDiv += '<div class="conference-box"><span class="title">END OF WORLD?</span></div>';
        }

        return cfpDiv
    }

    function createBanner(data){
        var links = data["phd_comics"];

        var i = Math.floor((Math.random() * links.length) + 1);
        document.getElementById("bannerImage").src = links[i];
        var renew = setInterval(function(){
            if(links.length == i){
                i = 0;
            }
            document.getElementById("bannerImage").src = links[i];
            i += 1;
        },5000);
    }

    $(document).ready(function () {
        var dnow = moment().format("dddd, MMMM Do YYYY, h:mm:ss a");
        console.log(dnow);
        $('#conference-container').append('<h3>' + dnow + '</h3>');

        $.getJSON('cfp_data.json',
        function (json) {
            $('#conference-container').append(drawTable(json));
        });

        $.getJSON('phd_comics.json',
        function (json) {
            createBanner(json);
        });
    });
</script>


<div id="conferences">
    <div id="phd_comics_banner">
        <img id="bannerImage"/>
    </div>
    <div id="timenow"></div>
    <div id="conference-container"></div>
</div>